<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Enrich Serilog messages with Http Headers | rmauro.dev {blog}</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Serilog.AspNetCore is a package that provides middleware to simplify the logging process for .NET Web Applications. It is built on top of Serilog, a popular logging framework that offers an efficient and flexible way to capture application events and generate logs for debugging, troubleshooting, and auditing.
One of the primary features of Serilog is the ability to enrich log events with contextual information of any kind, such as HTTP headers, that can help developers understand application behavior and diagnose issues more efficiently.">
    <meta name="generator" content="Hugo 0.130.0">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/post/enrich-your-log-with-http-request-information/">
    

    <meta property="og:url" content="http://localhost:1313/post/enrich-your-log-with-http-request-information/">
  <meta property="og:site_name" content="rmauro.dev {blog}">
  <meta property="og:title" content="Enrich Serilog messages with Http Headers">
  <meta property="og:description" content="Serilog.AspNetCore is a package that provides middleware to simplify the logging process for .NET Web Applications. It is built on top of Serilog, a popular logging framework that offers an efficient and flexible way to capture application events and generate logs for debugging, troubleshooting, and auditing.
One of the primary features of Serilog is the ability to enrich log events with contextual information of any kind, such as HTTP headers, that can help developers understand application behavior and diagnose issues more efficiently.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2023-04-04T19:28:05+00:00">
    <meta property="article:modified_time" content="2023-04-04T19:28:05+00:00">

  <meta itemprop="name" content="Enrich Serilog messages with Http Headers">
  <meta itemprop="description" content="Serilog.AspNetCore is a package that provides middleware to simplify the logging process for .NET Web Applications. It is built on top of Serilog, a popular logging framework that offers an efficient and flexible way to capture application events and generate logs for debugging, troubleshooting, and auditing.
One of the primary features of Serilog is the ability to enrich log events with contextual information of any kind, such as HTTP headers, that can help developers understand application behavior and diagnose issues more efficiently.">
  <meta itemprop="datePublished" content="2023-04-04T19:28:05+00:00">
  <meta itemprop="dateModified" content="2023-04-04T19:28:05+00:00">
  <meta itemprop="wordCount" content="602">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Enrich Serilog messages with Http Headers">
  <meta name="twitter:description" content="Serilog.AspNetCore is a package that provides middleware to simplify the logging process for .NET Web Applications. It is built on top of Serilog, a popular logging framework that offers an efficient and flexible way to capture application events and generate logs for debugging, troubleshooting, and auditing.
One of the primary features of Serilog is the ability to enrich log events with contextual information of any kind, such as HTTP headers, that can help developers understand application behavior and diagnose issues more efficiently.">

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        rmauro.dev {blog}
      
    </a>
    <div class="flex-l items-center">
      

      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">Enrich Serilog messages with Http Headers</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2023-04-04T19:28:05Z">April 4, 2023</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p><strong>Serilog.AspNetCore</strong> is a package that provides middleware to simplify the logging process for <strong>.NET Web Applications</strong>. It is built on top of <strong>Serilog</strong>, a popular logging framework that offers an efficient and flexible way to capture application events and generate logs for debugging, troubleshooting, and auditing.</p>
<p>One of the primary features of <code>Serilog</code> is the ability to enrich log events with contextual information of any kind, such as HTTP headers, that can help developers understand application behavior and diagnose issues more efficiently.</p>
<p>In this blog post, we will explore how to leverage <code>Serilog.AspNetCore</code> middleware to capture HTTP headers and include them in our logs. We will discuss how enriching our log messages with HTTP headers information can help us better understand our application&rsquo;s behavior and make troubleshooting more efficient.</p>
<h2 id="the-problem">The Problem</h2>
<p>When a web application logs a message, it typically includes basic information such as the log level, timestamp, and message text. However, this information may not be enough to understand what caused the issue. For example, if an error occurred in a web application, it may be challenging to determine the user&rsquo;s identity or the <em>URL</em> they were trying to access at the time of the error.</p>
<p>To solve this problem, we need to enrich our logs with additional information. One way to do this is by adding <strong>HTTP Headers</strong> information to our log messages.</p>
<h2 id="requirements">Requirements</h2>
<p>Before we can use <em>Serilog</em> to enrich our logs with <em>HTTP Headers</em> information, we need to make sure we have the required packages installed.</p>
<p>To get started, we need to install the following packages:</p>
<ul>
<li>Serilog</li>
<li>Serilog.AspNetCore</li>
</ul>
<p>These packages can be installed using the NuGet package manager or by adding the following package references to our project file:</p>
<figure><img src="https://res-4.cloudinary.com/dgoa5llvh/image/upload/q_auto/serilog-dependencies.png"
    alt="Installed Packages"><figcaption>
      <p>Installed Packages</p>
    </figcaption>
</figure>

<p>Or</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;ItemGroup&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;PackageReference</span> <span style="color:#a6e22e">Include=</span><span style="color:#e6db74">&#34;Serilog&#34;</span> <span style="color:#a6e22e">Version=</span><span style="color:#e6db74">&#34;2.10.0&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;PackageReference</span> <span style="color:#a6e22e">Include=</span><span style="color:#e6db74">&#34;Serilog.AspNetCore&#34;</span> <span style="color:#a6e22e">Version=</span><span style="color:#e6db74">&#34;4.1.0&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/ItemGroup&gt;</span>
</span></span></code></pre></div><h3 id="basic-aspnet-project-setup">Basic AspNet Project Setup</h3>
<p>Here is a code sample with <em>Serilog</em> enabled.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Serilog;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Log.Logger = <span style="color:#66d9ef">new</span> LoggerConfiguration()
</span></span><span style="display:flex;"><span>    .WriteTo.Console()
</span></span><span style="display:flex;"><span>    .CreateLogger();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Log.Information(<span style="color:#e6db74">&#34;Starting web application&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> builder = WebApplication.CreateBuilder(args);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    builder.Host.UseSerilog(); 
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> app = builder.Build();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    app.MapGet(<span style="color:#e6db74">&#34;/&#34;</span>, () =&gt; <span style="color:#e6db74">&#34;Hello World!&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    app.Run();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">catch</span> (Exception ex)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Log.Fatal(ex, <span style="color:#e6db74">&#34;Application terminated unexpectedly&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">finally</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Log.CloseAndFlush();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="adding-enricher-information">Adding Enricher Information</h2>
<p>To enrich our logs with HTTP headers information using Serilog, we need to configure the Serilog middleware in our application. We can achieve this by using the <code>UseSerilogRequestLogging</code> extension method provided by Serilog.</p>
<p>In the code example at the top of this blog post, we can see an example of how to configure Serilog middleware to enrich our logs with HTTP headers information.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>app.UseSerilogRequestLogging(x =&gt;
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    x.EnrichDiagnosticContext = (diagnosticContext, httpContext) =&gt;
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    	diagnosticContext.Set(<span style="color:#e6db74">&#34;RequestHost&#34;</span>, httpContext.Request.Host.Value);
</span></span><span style="display:flex;"><span>        diagnosticContext.Set(<span style="color:#e6db74">&#34;RequestScheme&#34;</span>, httpContext.Request.Scheme);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        diagnosticContext.Set(<span style="color:#e6db74">&#34;ClientIp&#34;</span>, httpContext.Connection.RemoteIpAddress);
</span></span><span style="display:flex;"><span>        diagnosticContext.Set(<span style="color:#e6db74">&#34;ClientAgent&#34;</span>, httpContext.Request.Headers.UserAgent);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (httpContext.Request.QueryString.HasValue)
</span></span><span style="display:flex;"><span>        	diagnosticContext.Set(<span style="color:#e6db74">&#34;QueryString&#34;</span>, httpContext.Request.QueryString.Value);
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Set the content-type of the Response at this point</span>
</span></span><span style="display:flex;"><span>        diagnosticContext.Set(<span style="color:#e6db74">&#34;ContentType&#34;</span>, httpContext.Response.ContentType);
</span></span><span style="display:flex;"><span>	};
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>In the above code example, we&rsquo;re setting up the <em>Serilog</em> middleware to log additional information such as the Request Host, Request Scheme, Client IP, Client Agent, and Query String (if present). We&rsquo;re also setting the Content Type of the response, which can be useful in identifying issues with the response content.</p>
<h2 id="conclusion">Conclusion</h2>
<p>In this blog post, we&rsquo;ve explored how to enrich our logs with additional HTTP headers information using Serilog. By doing this, we can make our logs more informative and easier to understand, which can be invaluable when debugging issues in our web applications.</p>
<p>By setting up the Serilog middleware in our web application, we can quickly add HTTP headers information to our log messages, making it easier to understand what is happening inside our application. This can save developers time and effort, making it easier to identify and fix issues, ultimately resulting in a better experience for users.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  rmauro.dev {blog} 2024 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
