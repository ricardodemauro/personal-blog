<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>HSTS - What&#39;s it and how to enable it in IIS | rmauro.dev {blog}</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="###HSTS, what&rsquo;s it?
Definition from wikipedia:
HTTP Strict Transport Security (HSTS) is a web security policy mechanism which helps to protect websites against protocol downgrade attacks and cookie hijacking. It allows web servers to declare that web browsers (or other complying user agents) should only interact with it using secure HTTPS connections,[1] and never via the insecure HTTP protocol. HSTS is an IETF standards track protocol and is specified in RFC 6797.">
    <meta name="generator" content="Hugo 0.130.0">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/post/hsts-definition-and-how-to-enable-it-in-iis/">
    

    <meta property="og:url" content="http://localhost:1313/post/hsts-definition-and-how-to-enable-it-in-iis/">
  <meta property="og:site_name" content="rmauro.dev {blog}">
  <meta property="og:title" content="HSTS - What&#39;s it and how to enable it in IIS">
  <meta property="og:description" content="###HSTS, what’s it?
Definition from wikipedia:
HTTP Strict Transport Security (HSTS) is a web security policy mechanism which helps to protect websites against protocol downgrade attacks and cookie hijacking. It allows web servers to declare that web browsers (or other complying user agents) should only interact with it using secure HTTPS connections,[1] and never via the insecure HTTP protocol. HSTS is an IETF standards track protocol and is specified in RFC 6797.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2017-08-09T18:10:00+00:00">
    <meta property="article:modified_time" content="2017-08-09T18:10:00+00:00">
    <meta property="article:tag" content="IIS">
    <meta property="article:tag" content="HSTS">
    <meta property="article:tag" content="Https">
    <meta property="article:tag" content="Security">
    <meta property="article:tag" content="Websecurity">
    <meta property="article:tag" content="En">

  <meta itemprop="name" content="HSTS - What&#39;s it and how to enable it in IIS">
  <meta itemprop="description" content="###HSTS, what’s it?
Definition from wikipedia:
HTTP Strict Transport Security (HSTS) is a web security policy mechanism which helps to protect websites against protocol downgrade attacks and cookie hijacking. It allows web servers to declare that web browsers (or other complying user agents) should only interact with it using secure HTTPS connections,[1] and never via the insecure HTTP protocol. HSTS is an IETF standards track protocol and is specified in RFC 6797.">
  <meta itemprop="datePublished" content="2017-08-09T18:10:00+00:00">
  <meta itemprop="dateModified" content="2017-08-09T18:10:00+00:00">
  <meta itemprop="wordCount" content="363">
  <meta itemprop="keywords" content="IIS,HSTS,Https,Security,Websecurity,En">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="HSTS - What&#39;s it and how to enable it in IIS">
  <meta name="twitter:description" content="###HSTS, what’s it?
Definition from wikipedia:
HTTP Strict Transport Security (HSTS) is a web security policy mechanism which helps to protect websites against protocol downgrade attacks and cookie hijacking. It allows web servers to declare that web browsers (or other complying user agents) should only interact with it using secure HTTPS connections,[1] and never via the insecure HTTP protocol. HSTS is an IETF standards track protocol and is specified in RFC 6797.">

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        rmauro.dev {blog}
      
    </a>
    <div class="flex-l items-center">
      

      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">HSTS - What&#39;s it and how to enable it in IIS</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2017-08-09T18:10:00Z">August 9, 2017</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>###HSTS, what&rsquo;s it?</p>
<p>Definition from wikipedia:</p>
<blockquote>
<p>HTTP Strict Transport Security (HSTS) is a web security policy mechanism which helps to protect websites against protocol downgrade attacks and cookie hijacking. It allows web servers to declare that web browsers (or other complying user agents) should only interact with it using secure HTTPS connections,[1] and never via the insecure HTTP protocol. HSTS is an IETF standards track protocol and is specified in RFC 6797.`</p>
</blockquote>
<p>An example to help clearify:</p>
<ul>
<li>
<p>You decide to visit / (HTTP version), you send a request to the webserver saying the you want visit this website.</p>
</li>
<li>
<p>The webserver respond with HTTP STATUS 301 (Moved Permanently) directing you to /.</p>
</li>
</ul>
<p><img src="https://res-4.cloudinary.com/ht54oxr6q/image/upload/q_auto/v1/ghost-blog-images/http-1.png" alt="http-1"></p>
<p><em>HTTP version request</em></p>
<p>Once you get the response o HTTPS version you also receive a header named &ldquo;Strict-Transport-Security&rdquo; - The famous <strong>HSTS</strong>.</p>
<p><img src="https://res-5.cloudinary.com/ht54oxr6q/image/upload/q_auto/v1/ghost-blog-images/hsts-headers.png" alt="hsts-headers"></p>
<p><em>Legend: HTTPS request after redirect</em></p>
<p><img src="https://res-5.cloudinary.com/ht54oxr6q/image/upload/q_auto/v1/ghost-blog-images/request-flow.png" alt="request-flow"></p>
<p><em>Legend: Request flow with HSTS enabled</em></p>
<p>Now the browser know&rsquo;s that your website is HSTS and HTTPS enabled.
Every time you decide to go to HTTP version of this site, your browser will direct you to HTTPS version of the site, without sending a request to HTTP version first.</p>
<p>###How enabled it on IIS</p>
<p>It&rsquo;s very simple. Here is a how:</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;configuration&gt;
    &lt;system.webServer&gt;
        &lt;rewrite&gt;
            &lt;rules&gt;
                &lt;rule name=&quot;HTTP to HTTPS redirect&quot; stopProcessing=&quot;true&quot;&gt;
                    &lt;match url=&quot;(.*)&quot; /&gt;
                    &lt;conditions&gt;
                        &lt;add input=&quot;{HTTPS}&quot; pattern=&quot;off&quot; ignoreCase=&quot;true&quot; /&gt;
                    &lt;/conditions&gt;
                    &lt;action type=&quot;Redirect&quot; 
                            url=&quot;https://{HTTP_HOST}/{R:1}&quot;
                            redirectType=&quot;Permanent&quot; /&gt;
                &lt;/rule&gt;
            &lt;/rules&gt;
            &lt;outboundRules&gt;
                &lt;rule name=&quot;Add Strict-Transport-Security when HTTPS&quot; enabled=&quot;true&quot;&gt;
                    &lt;match serverVariable=&quot;RESPONSE_Strict_Transport_Security&quot;
                           pattern=&quot;.*&quot; /&gt;
                    &lt;conditions&gt;
                        &lt;add input=&quot;{HTTPS}&quot; pattern=&quot;on&quot; ignoreCase=&quot;true&quot; /&gt;
                    &lt;/conditions&gt;
                    &lt;action type=&quot;Rewrite&quot; value=&quot;max-age=31536000&quot; /&gt;
                &lt;/rule&gt;
            &lt;/outboundRules&gt;
        &lt;/rewrite&gt;
    &lt;/system.webServer&gt;
&lt;/configuration&gt;
</code></pre>
<p>Explaining what&rsquo;s going on there.</p>
<ul>
<li>First rule (<strong>HTTP to HTTPS redirect</strong>) tells IIS to redirect every request to HTTS if not there.</li>
<li>Second rule (<strong>Add Strict-Transport-Security when HTTPS</strong>)</li>
</ul>
<p><strong>Now you must be thinking with yourself, why not just add a simple HTTP-Header in config?</strong></p>
<p>The HSTS (RFC6797) spec says:</p>
<blockquote>
<p>An HTTP host declares itself an HSTS Host by issuing to UAs (User Agents) an HSTS Policy, which is represented by and conveyed via the
Strict-Transport-Security HTTP response header field over secure transport (e.g., TLS). `</p>
</blockquote>
<p>So you should not send the header in HTTP version of the website.</p>
<p>####Sources:
Wikipedia
<code>https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security</code></p>
<p>Hanselman&rsquo;s blog
<code>https://www.hanselman.com/blog/HowToEnableHTTPStrictTransportSecurityHSTSInIIS7.aspx</code></p>
<p>HSTS RFC
<code>http://tools.ietf.org/html/rfc6797#page-12</code></p>
<ul class="pa0">
  
   <li class="list di">
     <a href="/tags/IIS/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">IIS</a>
   </li>
  
   <li class="list di">
     <a href="/tags/HSTS/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">HSTS</a>
   </li>
  
   <li class="list di">
     <a href="/tags/https/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Https</a>
   </li>
  
   <li class="list di">
     <a href="/tags/security/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Security</a>
   </li>
  
   <li class="list di">
     <a href="/tags/websecurity/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Websecurity</a>
   </li>
  
   <li class="list di">
     <a href="/tags/en/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">En</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/post/how-to-migrate-asp-net-core-1-0-to-1-1/">How to migrate .Net Core 1.0 to 1.1</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  rmauro.dev {blog} 2024 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
